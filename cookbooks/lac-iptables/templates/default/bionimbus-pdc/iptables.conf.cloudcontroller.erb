*filter
:INPUT DROP [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:ANNAI_LABS  -  [0:0]
:OICR_SENSA - [0:0]
:ENSEMBLE_MYSQL - [0:0]
:<%= node['canary'].upcase %> - [0:0]

# accept opened connections
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A OUTPUT -m state --state RELATED,ESTABLISHED -j ACCEPT

# allow full privnet access
-A INPUT -s 10.16.0.0/16 -j ACCEPT
-A OUTPUT -d 10.16.0.0/16 -j ACCEPT

#allow nagios
-A INPUT  -s 10.103.110.249 -j ACCEPT
-A OUTPUT  -d 10.103.110.249 -j ACCEPT
#icinga
-A INPUT -s 10.8.0.21 -j ACCEPT
-A OUTPUT -d 10.8.0.21 -j ACCEPT
#allow logstash logging server
-A INPUT -s 10.8.0.22 -j ACCEPT
-A OUTPUT -d 10.8.0.22 -j ACCEPT

#Allow backup network for now
-A INPUT  -s 192.168.251.0/24 -d 192.168.251.0/24 -j ACCEPT
-A OUTPUT -s 192.168.251.0/24 -d 192.168.251.0/24 -j ACCEPT

# allow full privnet access
-A INPUT -s 172.16.0.0/16 -d 172.16.0.0/16 -j ACCEPT
-A OUTPUT -s 172.16.0.0/16 -d 172.16.0.0/16 -j ACCEPT

# allow public ssh access
-A INPUT -m tcp -p tcp --dport 22 -j ACCEPT
-A OUTPUT -m tcp -p tcp  --dport 22  -j ACCEPT
-A OUTPUT -m tcp -p tcp  --sport 22  -j ACCEPT

# allow MDNS traffic
-A INPUT -p udp --dport 5353 -d 224.0.0.251 -j ACCEPT

#Allow in rsync
-A INPUT -m tcp -p tcp --dport 873 -j ACCEPT

#Allow UDR
-A INPUT -p udp -m udp --dport 9000:9010 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 9000:9010 -j ACCEPT
-A OUTPUT -p udp -m udp --dport 9000:9010 -j ACCEPT
-A OUTPUT -p tcp -m tcp --dport 9000:9010 -j ACCEPT

#Allow in tukey
-A INPUT -i eth2.3523 -p tcp --dport 80 -j ACCEPT
-A INPUT -i eth2.3523 -p tcp --dport 443 -j ACCEPT



#ASPERA
-A INPUT -p udp -m udp --dport 33001:33020  -j ACCEPT
-A OUTPUT -p udp -m udp --dport 33001:33020  -j ACCEPT

# Openstack API
-A INPUT -p tcp -m tcp --dport 48773 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 48774 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 48775 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 49191 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 49292 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 48776 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 45000 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 49192 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 45357 -j ACCEPT
#Tukey
-A INPUT -s 10.103.114.53/32 -p tcp -m tcp --dport 5000 -j ACCEPT


# accept anything on loopback
-A INPUT -i lo -j ACCEPT
-A OUTPUT -o lo -j ACCEPT

#Nagios and Cacti
-A INPUT -pudp -mudp -s 10.103.110.249 -j ACCEPT
-A INPUT -s 10.8.0.21 -j ACCEPT
-A OUTPUT -d 10.8.0.21 -j ACCEPT
-A INPUT -pudp -mudp --dport 161 -j REJECT

# allow pings
-A INPUT -p ICMP --icmp-type echo-request -j ACCEPT
-A OUTPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT

-A OUTPUT -d 54.165.156.160 -j OICR_SENSA
-A OICR_SENSA -p tcp -m tcp --dport 5671  -j ACCEPT
-A OICR_SENSA -p udp -m udp --dport 5671  -j ACCEPT

-A OUTPUT -j ENSEMBLE_MYSQL

-A ENSEMBLE_MYSQL -p tcp -m tcp -d ensembldb.ensembl.org --match multiport --dports  3306,5306,3337,4306 -j ACCEPT
-A ENSEMBLE_MYSQL -p tcp -m tcp -d useastdb.ensembl.org --match multiport --dports  3306,5306 -j ACCEPT
-A ENSEMBLE_MYSQL -p tcp -m tcp -d asiadb.ensembl.org --match multiport --dports  3306,5306 -j ACCEPT
-A ENSEMBLE_MYSQL -p tcp -m tcp -d martdb.ensembl.org --match multiport --dports 3316,5316 -j ACCEPT
-A ENSEMBLE_MYSQL -p tcp -m tcp -d genome-mysql.cse.ucsc.edu --dport 3306  -j ACCEPT


-A INPUT -i eth2.3523 -j DROP



COMMIT

# Completed on Thu Jan 24 12:23:11 2013
# Generated by iptables-save v1.4.12 on Thu Jan 24 12:23:11 2013
*nat
:PREROUTING ACCEPT [8316048:1925899220]
:INPUT ACCEPT [4552035:451881410]
:OUTPUT ACCEPT [3668454:221800830]
:POSTROUTING ACCEPT [3614145:218058996]
-A POSTROUTING -o eth2.3523 -j MASQUERADE
COMMIT
